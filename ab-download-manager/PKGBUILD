pkgname=ab-download-manager
classname=com-abdownloadmanager-desktop-AppKt
_pkgname=ABDownloadManager
pkgver=1.6.10
pkgrel=1
pkgdesc="A Download Manager that speeds up your downloads"
arch=("x86_64")
url="https://abdownloadmanager.com/"
license=("Apache-2.0")
depends=("glibc" "java-runtime" "zlib" "alsa-lib" "libglvnd" "libxi" "freetype2" "libxtst" "libxrender" "fontconfig" "libx11" "libxext" "libappindicator-gtk3")
makedepends=("imagemagick")
options=(!debug)
source=("https://github.com/amir1376/${pkgname}/releases/download/v${pkgver}/ABDownloadManager_${pkgver}_linux_x64.tar.gz")
sha256sums=("0f4670470757afe63ec670b66568d24d21de50092680cde638245671939cec8b")

package() {
    install -d "${pkgdir}/opt/"
    install -d "${pkgdir}/usr/share/icons/hicolor/"{512x512,256x256,128x128,64x64,48x48,32x32,16x16}/apps
    install -d "${pkgdir}/usr/bin/"

    magick -background none "${srcdir}/app_logo.svg" -resize 512x512 "${pkgdir}/usr/share/icons/hicolor/512x512/apps/${classname}.png"
    magick -background none "${srcdir}/app_logo.svg" -resize 256x256 "${pkgdir}/usr/share/icons/hicolor/256x256/apps/${classname}.png"
    magick -background none "${srcdir}/app_logo.svg" -resize 128x128 "${pkgdir}/usr/share/icons/hicolor/128x128/apps/${classname}.png"
    magick -background none "${srcdir}/app_logo.svg" -resize 64x64 "${pkgdir}/usr/share/icons/hicolor/64x64/apps/${classname}.png"
    magick -background none "${srcdir}/app_logo.svg" -resize 48x48 "${pkgdir}/usr/share/icons/hicolor/48x48/apps/${classname}.png"
    magick -background none "${srcdir}/app_logo.svg" -resize 32x32 "${pkgdir}/usr/share/icons/hicolor/32x32/apps/${classname}.png"
    magick -background none "${srcdir}/app_logo.svg" -resize 16x16 "${pkgdir}/usr/share/icons/hicolor/16x16/apps/${classname}.png"
    chmod +x "${srcdir}/${_pkgname}/bin/${_pkgname}"
    mv "${srcdir}/${_pkgname}" "${pkgdir}/opt"
    ln -s "/opt/${_pkgname}/bin/${_pkgname}" "${pkgdir}/usr/bin/${_pkgname}"
    install -Dm644 /dev/stdin "${pkgdir}/usr/share/applications/com.abdownloadmanager.desktop" <<EOF
[Desktop Entry]
Name=AB Download Manager
Comment=Manage and organize your download files better than before
GenericName=Download Manager
Exec=env SKIKO_RENDER_API=SOFTWARE ${_pkgname}
Icon=${classname}
Terminal=false
Type=Application
Categories=Network;Utility;
StartupWMClass=${classname}
EOF
}
